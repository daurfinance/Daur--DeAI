# Требования к API Daur-AI

**Версия:** 1.0
**Дата:** 1 декабря 2025 г.

---

## 1. Введение

Этот документ определяет требования к API (Application Programming Interface) для взаимодействия с сетью Daur-AI. API предназначен для разработчиков, которые хотят интегрировать свои приложения с Daur-AI для выполнения задач искусственного интеллекта.

## 2. Общие принципы

- **RESTful архитектура:** API должен следовать принципам REST.
- **Формат данных:** Все данные должны передаваться в формате JSON.
- **Аутентификация:** Все запросы должны быть аутентифицированы с помощью API-ключей.
- **Обработка ошибок:** API должен возвращать стандартизированные коды ошибок и сообщения.
- **Версионирование:** API должен поддерживать версионирование через URL (например, `/v1/tasks`).

## 3. Эндпоинты

### 3.1. Управление задачами (`/tasks`)

#### `POST /v1/tasks`

- **Назначение:** Создание новой задачи.
- **Тело запроса:**
  ```json
  {
    "name": "Image Classification Task",
    "description": "Classify a batch of 1000 images",
    "input_cid": "Qm...", // CID файла с входными данными в IPFS
    "model_cid": "Qm...", // CID модели ИИ в IPFS
    "reward": 100.0, // Вознаграждение в токенах DAUR
    "priority": "normal" // (low, normal, high)
  }
  ```
- **Ответ (201 Created):**
  ```json
  {
    "task_id": "...",
    "status": "created",
    "created_at": "..."
  }
  ```

#### `GET /v1/tasks/{task_id}`

- **Назначение:** Получение статуса задачи.
- **Ответ (200 OK):**
  ```json
  {
    "task_id": "...",
    "name": "...",
    "status": "processing", // (created, processing, completed, failed)
    "progress": 42.5,
    "result_cid": null, // CID файла с результатом в IPFS
    "created_at": "...",
    "completed_at": null
  }
  ```

#### `GET /v1/tasks`

- **Назначение:** Получение списка задач пользователя.
- **Параметры запроса:** `limit`, `offset`, `status`.
- **Ответ (200 OK):** Массив объектов задач.

### 3.2. Управление результатами (`/results`)

#### `GET /v1/results/{result_cid}`

- **Назначение:** Получение результата задачи из IPFS.
- **Ответ:** Файл с результатом (например, JSON, CSV, изображение).

### 3.3. Управление узлами (`/nodes`)

#### `GET /v1/nodes`

- **Назначение:** Получение списка активных узлов в сети.
- **Параметры запроса:** `limit`, `offset`, `min_reputation`.
- **Ответ (200 OK):** Массив объектов узлов.

#### `GET /v1/nodes/{node_id}`

- **Назначение:** Получение информации о конкретном узле.
- **Ответ (200 OK):**
  ```json
  {
    "node_id": "...",
    "status": "online",
    "reputation": 98.5,
    "device_type": "smartphone",
    "location": "..."
  }
  ```

### 3.4. Управление моделями (`/models`)

#### `GET /v1/models`

- **Назначение:** Получение списка доступных моделей ИИ.
- **Ответ (200 OK):** Массив объектов моделей.

#### `GET /v1/models/{model_cid}`

- **Назначение:** Получение информации о конкретной модели.
- **Ответ (200 OK):**
  ```json
  {
    "model_cid": "...",
    "name": "ImageNet Classifier",
    "version": "1.2.0",
    "description": "..."
  }
  ```

## 4. WebSocket API

- **URL:** `wss://api.daur-ai.com/v1/ws`
- **Аутентификация:** Через токен, полученный по REST API.
- **Подписка на события:**
  ```json
  {
    "action": "subscribe",
    "event": "task_update",
    "task_id": "..."
  }
  ```
- **События от сервера:**
  ```json
  {
    "event": "task_update",
    "data": {
      "task_id": "...",
      "status": "completed",
      "progress": 100.0,
      "result_cid": "Qm..."
    }
  }
  ```

## 5. Коды ошибок

- **400 Bad Request:** Некорректный запрос.
- **401 Unauthorized:** Ошибка аутентификации.
- **403 Forbidden:** Недостаточно прав.
- **404 Not Found:** Ресурс не найден.
- **500 Internal Server Error:** Внутренняя ошибка сервера.

---
